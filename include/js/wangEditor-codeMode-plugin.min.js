/**
 * wangEditor-codeMode-plugin
 *
 * wangEditor-codeMode-plugin is donationware. Welcome to use and contact us.
 *
 * @author:Leaf
 * QQ:182397814
 *
 * @version
 * 0.4 (2018/08/20)
 *
 * @copyright
 * Copyright (C) 2018 IT路-新生代开发者之路.
 * http://www.aitlu.com
 * QQ Group:450968368
 */
function js_beautify(l,q,u,d){function c(){for(;k.length&&(" "===k[k.length-1]||k[k.length-1]===w);)k.pop()}function b(b){b="undefined"===typeof b?!0:b;c();if(k.length)for("\n"===k[k.length-1]&&b||k.push("\n"),b=0;b<d;b++)k.push(w)}function a(){var b=k.length?k[k.length-1]:" ";" "!==b&&"\n"!==b&&b!==w&&k.push(" ")}function m(){k.push(h)}function C(){B="DO_BLOCK"===p;p=z.pop()}function t(b,c){for(var a=0;a<c.length;a++)if(c[a]===b)return!0;return!1}function D(){var c=0;do{if(e>=g.length)return["",
    "TK_EOF"];var a=g.charAt(e);e+=1;"\n"===a&&(c+=1)}while(t(a,G));if(1<c)for(var d=0;2>d;d++)b(0===d);c=1===c;if(t(a,E)){if(e<g.length)for(;t(g.charAt(e),E)&&(a+=g.charAt(e),e+=1,e!==g.length););return e!==g.length&&a.match(/^[0-9]+[Ee]$/)&&"-"===g.charAt(e)?(e+=1,c=D(e),a+="-"+c[0],[a,"TK_WORD"]):"in"===a?[a,"TK_OPERATOR"]:[a,"TK_WORD"]}if("("===a||"["===a)return[a,"TK_START_EXPR"];if(")"===a||"]"===a)return[a,"TK_END_EXPR"];if("{"===a)return[a,"TK_START_BLOCK"];if("}"===a)return[a,"TK_END_BLOCK"];
    if(";"===a)return[a,"TK_END_COMMAND"];if("/"===a){d="";if("*"===g.charAt(e)){e+=1;if(e<g.length)for(;("*"!==g.charAt(e)||!g.charAt(e+1)||"/"!==g.charAt(e+1))&&e<g.length&&!(d+=g.charAt(e),e+=1,e>=g.length););e+=2;return["/*"+d+"*/","TK_BLOCK_COMMENT"]}if("/"===g.charAt(e)){for(d=a;"\r"!==g.charAt(e)&&"\n"!==g.charAt(e)&&!(d+=g.charAt(e),e+=1,e>=g.length););e+=1;c&&b();return[d,"TK_COMMENT"]}}if("'"===a||'"'===a||"/"===a&&("TK_WORD"===f&&"return"===r||"TK_START_EXPR"===f||"TK_END_BLOCK"===f||"TK_OPERATOR"===
        f||"TK_EOF"===f||"TK_END_COMMAND"===f)){c=a;d=!1;a="";if(e<g.length)for(;(d||g.charAt(e)!==c)&&!(a+=g.charAt(e),d=d?!1:"\\"===g.charAt(e),e+=1,e>=g.length););e+=1;"TK_END_COMMAND"===f&&b();return[c+a+c,"TK_STRING"]}if(t(a,F)){for(;e<g.length&&t(a+g.charAt(e),F)&&!(a+=g.charAt(e),e+=1,e>=g.length););return[a,"TK_OPERATOR"]}return[a,"TK_UNKNOWN"]}var w,B,v;u=u||" ";q=q||4;for(w="";q--;)w+=u;var g=l;l="";var f="TK_START_EXPR";var r="";var k=[];var A=v=B=!1;var G=["\n","\r","\t"," "];var E="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split("");
    var F="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |=".split(" ");q="continue try throw return var if switch case default for while break function".split(" ");var p="BLOCK";var z=[p];d=d||0;var e=0;for(u=!1;;){var x=D(e);var h=x[0];x=x[1];if("TK_EOF"===x)break;switch(x){case "TK_START_EXPR":v=!1;z.push(p);p="EXPRESSION";"TK_END_EXPR"!==f&&"TK_START_EXPR"!==f&&("TK_WORD"!==f&&"TK_OPERATOR"!==f?a():t(l,q)&&"function"!==l&&a());m();break;
        case "TK_END_EXPR":m();C();break;case "TK_START_BLOCK":"do"===l?(z.push(p),p="DO_BLOCK"):(z.push(p),p="BLOCK");"TK_OPERATOR"!==f&&"TK_START_EXPR"!==f&&("TK_START_BLOCK"===f?b():a());m();d++;break;case "TK_END_BLOCK":"TK_START_BLOCK"===f?(c(),d&&d--):(d&&d--,b());m();C();break;case "TK_WORD":if(B){a();m();a();break}if("case"===h||"default"===h){":"===r?k.length&&k[k.length-1]===w&&k.pop():(d&&d--,b(),d++);m();u=!0;break}var n="NONE";"TK_END_BLOCK"===f?t(h.toLowerCase(),["else","catch","finally"])?
            (n="SPACE",a()):n="NEWLINE":"TK_END_COMMAND"!==f||"BLOCK"!==p&&"DO_BLOCK"!==p?"TK_END_COMMAND"===f&&"EXPRESSION"===p?n="SPACE":"TK_WORD"===f?n="SPACE":"TK_START_BLOCK"===f?n="NEWLINE":"TK_END_EXPR"===f&&(a(),n="NEWLINE"):n="NEWLINE";if("TK_END_BLOCK"!==f&&t(h.toLowerCase(),["else","catch","finally"]))b();else if(t(h,q)||"NEWLINE"===n)if("else"===r)a();else{if("TK_START_EXPR"!==f&&"="!==r||"function"!==h)"TK_WORD"!==f||"return"!==r&&"throw"!==r?"TK_END_EXPR"!==f?"TK_START_EXPR"===f&&"var"===h||":"===
            r||("if"===h&&"TK_WORD"===f&&"else"===l?a():b()):t(h,q)&&")"!==r&&b():a()}else"SPACE"===n&&a();m();l=h;"var"===h&&(v=!0,A=!1);break;case "TK_END_COMMAND":m();v=!1;break;case "TK_STRING":"TK_START_BLOCK"===f||"TK_END_BLOCK"===f?b():"TK_WORD"===f&&a();m();break;case "TK_OPERATOR":var y=n=!0;v&&","!==h&&(A=!0,":"===h&&(v=!1));if(":"===h&&u){m();b();break}u=!1;if(","===h){v?A?(m(),b(),A=!1):(m(),a()):"TK_END_BLOCK"===f?(m(),b()):"BLOCK"===p?(m(),b()):(m(),a());break}else"--"===h||"++"===h?(n=";"===r?
            !0:!1,y=!1):"!"===h&&"TK_START_EXPR"===f?y=n=!1:"TK_OPERATOR"===f?y=n=!1:"TK_END_EXPR"===f?y=n=!0:"."===h?y=n=!1:":"===h&&(n=r.match(/^\d+$/)?!0:!1);n&&a();m();y&&a();break;case "TK_BLOCK_COMMENT":b();m();b();break;case "TK_COMMENT":a();m();b();break;case "TK_UNKNOWN":m()}f=x;r=h}return k.join("")}
function style_html(l,q,u,d){d=new function(){this.pos=0;this.token="";this.current_mode="CONTENT";this.tags={parent:"parent1",parentcount:1,parent1:""};this.token_text=this.last_token=this.last_text=this.token_type=this.tag_type="";this.Utils={whitespace:["\n","\r","\t"," "],single_token:"br input link meta !doctype basefont base area hr wbr param img isindex ?xml embed".split(" "),extra_liners:["head","body","/html"],in_array:function(c,b){for(var a=0;a<b.length;a++)if(c===b[a])return!0;return!1}};
    this.get_content=function(){for(var c,b=[],a=!1;"<"!==this.input.charAt(this.pos);){if(this.pos>=this.input.length)return b.length?b.join(""):["","TK_EOF"];c=this.input.charAt(this.pos);this.pos++;this.line_char_count++;if(this.Utils.in_array(c,this.Utils.whitespace))b.length&&(a=!0),this.line_char_count--;else{if(a){if(this.line_char_count>=this.max_char){b.push("\n");for(a=0;a<this.indent_level;a++)b.push(this.indent_string);this.line_char_count=0}else b.push(" "),this.line_char_count++;a=!1}b.push(c)}}return b.length?
        b.join(""):""};this.get_script=function(){var c=[];var b=/<\/script>/igm;b.lastIndex=this.pos;for(var a=(b=b.exec(this.input))?b.index:this.input.length;this.pos<a;){if(this.pos>=this.input.length)return c.length?c.join(""):["","TK_EOF"];b=this.input.charAt(this.pos);this.pos++;c.push(b)}return c.length?c.join(""):""};this.record_tag=function(c){this.tags[c+"count"]?this.tags[c+"count"]++:this.tags[c+"count"]=1;this.tags[c+this.tags[c+"count"]]=this.indent_level;this.tags[c+this.tags[c+"count"]+"parent"]=
        this.tags.parent;this.tags.parent=c+this.tags[c+"count"]};this.retrieve_tag=function(c){if(this.tags[c+"count"]){for(var b=this.tags.parent;b&&c+this.tags[c+"count"]!==b;)b=this.tags[b+"parent"];b&&(this.indent_level=this.tags[c+this.tags[c+"count"]],this.tags.parent=this.tags[b+"parent"]);delete this.tags[c+this.tags[c+"count"]+"parent"];delete this.tags[c+this.tags[c+"count"]];1==this.tags[c+"count"]?delete this.tags[c+"count"]:this.tags[c+"count"]--}};this.get_tag=function(){var c=[],b=!1;do{if(this.pos>=
        this.input.length)return c.length?c.join(""):["","TK_EOF"];var a=this.input.charAt(this.pos);this.pos++;this.line_char_count++;if(this.Utils.in_array(a,this.Utils.whitespace))b=!0,this.line_char_count--;else{if("'"===a||'"'===a)c[1]&&"!"===c[1]||(a+=this.get_unformatted(a),b=!0);"="===a&&(b=!1);c.length&&"="!==c[c.length-1]&&">"!==a&&b&&(this.line_char_count>=this.max_char?(this.print_newline(!1,c),this.line_char_count=0):(c.push(" "),this.line_char_count++),b=!1);c.push(a)}}while(">"!==a);a=c.join("");
        b=-1!=a.indexOf(" ")?a.indexOf(" "):a.indexOf(">");b=a.substring(1,b).toLowerCase();"/"===a.charAt(a.length-2)||this.Utils.in_array(b,this.Utils.single_token)?this.tag_type="SINGLE":"script"===b?(this.record_tag(b),this.tag_type="SCRIPT"):"style"===b?(this.record_tag(b),this.tag_type="STYLE"):"!"===b.charAt(0)?-1!=b.indexOf("[if")?(-1!=a.indexOf("!IE")&&(a=this.get_unformatted("--\x3e",a),c.push(a)),this.tag_type="START"):-1!=b.indexOf("[endif")?(this.tag_type="END",this.unindent()):(a=-1!=b.indexOf("[cdata[")?
            this.get_unformatted("]]\x3e",a):this.get_unformatted("--\x3e",a),c.push(a),this.tag_type="SINGLE"):("/"===b.charAt(0)?(this.retrieve_tag(b.substring(1)),this.tag_type="END"):(this.record_tag(b),this.tag_type="START"),this.Utils.in_array(b,this.Utils.extra_liners)&&this.print_newline(!0,this.output));return c.join("")};this.get_unformatted=function(c,b){if(b&&-1!=b.indexOf(c))return"";b="";var a=!0;do{var d=this.input.charAt(this.pos);this.pos++;if(this.Utils.in_array(d,this.Utils.whitespace)){if(!a){this.line_char_count--;
        continue}if("\n"===d||"\r"===d){b+="\n";for(d=0;d<this.indent_level;d++)b+=this.indent_string;a=!1;this.line_char_count=0;continue}}b+=d;this.line_char_count++;a=!0}while(-1==b.indexOf(c));return b};this.get_token=function(){if("TK_TAG_SCRIPT"===this.last_token){var c=this.get_script();if("string"!==typeof c)return c;c=js_beautify(c,this.indent_size,this.indent_character,this.indent_level);return[c,"TK_CONTENT"]}if("CONTENT"===this.current_mode)return c=this.get_content(),"string"!==typeof c?c:[c,
        "TK_CONTENT"];if("TAG"===this.current_mode)return c=this.get_tag(),"string"!==typeof c?c:[c,"TK_TAG_"+this.tag_type]};this.printer=function(c,b,a,d){this.input=c||"";this.output=[];this.indent_character=b||" ";this.indent_string="";this.indent_size=a||2;this.indent_level=0;this.max_char=d||7E3;for(c=this.line_char_count=0;c<this.indent_size;c++)this.indent_string+=this.indent_character;this.print_newline=function(a,b){this.line_char_count=0;if(b&&b.length){if(!a)for(;this.Utils.in_array(b[b.length-
    1],this.Utils.whitespace);)b.pop();b.push("\n");for(a=0;a<this.indent_level;a++)b.push(this.indent_string)}};this.print_token=function(a){this.output.push(a)};this.indent=function(){this.indent_level++};this.unindent=function(){0<this.indent_level&&this.indent_level--}};return this};d.printer(l,u,q);for(l=!0;;){q=d.get_token();d.token_text=q[0];d.token_type=q[1];if("TK_EOF"===d.token_type)break;switch(d.token_type){case "TK_TAG_START":case "TK_TAG_SCRIPT":case "TK_TAG_STYLE":d.print_newline(!1,d.output);
    d.print_token(d.token_text);d.indent();d.current_mode="CONTENT";break;case "TK_TAG_END":l&&d.print_newline(!0,d.output);d.print_token(d.token_text);d.current_mode="CONTENT";l=!0;break;case "TK_TAG_SINGLE":d.print_newline(!1,d.output);d.print_token(d.token_text);d.current_mode="CONTENT";break;case "TK_CONTENT":""!==d.token_text&&(l=!1,d.print_token(d.token_text)),d.current_mode="TAG"}d.last_token=d.token_type;d.last_text=d.token_text}return d.output.join("")}
window.wangEditor.codeMode={editorObj:null,$textarea:null,init:function(l){this.editorObj=l;$(this.editorObj.toolbarSelector+" .w-e-toolbar").append('<div class="w-e-menu"><a onclick="window.wangEditor.codeMode.toggleClick()">HTML</a></div>')},toggleClick:function(){if(null==this.$textarea){var l=$(this.editorObj.toolbarSelector);content=l.find(".w-e-text").html();content=content.replace(/^\s+/,"");tabsize=4;tabchar=" ";content=content&&"<"===content.charAt(0)?style_html(content,tabsize,tabchar,80):
        js_beautify(content,tabsize,tabchar);this.$textarea=$("<textarea wrap='hard' style='height:100%;width:100%;background:#444342;color:#ffffff;padding:10px;'>"+content+"</textarea>");this.$textarea.insertAfter(".w-e-text");jQuery(this.$textarea).bind("input propertychange",function(){l.find(".w-e-text").html(this.value)});l.find(".w-e-text").hide()}else this.$textarea.remove(),$(this.editorObj.toolbarSelector).find(".w-e-text").show(),this.$textarea=null}};